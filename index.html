<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      body {
        padding-top: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }
      canvas {
        border: 1px solid #ddd;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <div>
      <input type="file" id="file" />
      <button id="save">保存图片</button>
    </div>

    <canvas id="canvas"></canvas>

    <script>
      const CANVAS_WIDTH = 600;

      const file = document.getElementById("file");
      const canvas = document.getElementById("canvas");
      const save = document.getElementById("save");
      const ctx = canvas.getContext("2d");

      canvas.width = CANVAS_WIDTH;

      file.onchange = function () {
        const fileData = this.files[0];
        const pattern = /^image/;

        if (!pattern.test(fileData.type)) {
          alert("图片格式不正确");
          return;
        }

        const reader = new FileReader();
        reader.readAsDataURL(fileData); //异步读取文件内容，结果用data:url的字符串形式表示

        // /*当读取操作成功完成时调用*/
        reader.onload = function (e) {
          // draw upload image
          const backgroundImage = new Image();
          backgroundImage.src = this.result;
          backgroundImage.onload = function () {
            const { width, height } = this;

            const ratio = width / height;
            const canvas_height = 600 / ratio;

            canvas.height = canvas_height;

            console.log("draw background image");
            ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);

            // draw qrcode
            const qrcode = new Image();
            qrcode.src =
              "data:image/png;base64,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";
            qrcode.onload = function () {
              console.log("draw qrcode");
              ctx.drawImage(
                qrcode,
                canvas.width - 100,
                canvas.height - 100,
                100,
                100
              );

              // draw author
              console.log("draw author text");
              ctx.font = "16px ui-sans-serif";
              ctx.fillText("Hello world", 20, canvas.height - 20);
            };
          };
        };
      };

      // donwload image
      save.onclick = function () {
        const imgBase64Url = canvas.toDataURL("image/png");
        const a = document.createElement("a");
        document.body.appendChild(a);
        a.href = imgBase64Url;
        a.download = new Date().toLocaleString();
        a.click();
        a.remove();
      };
    </script>
  </body>
</html>
